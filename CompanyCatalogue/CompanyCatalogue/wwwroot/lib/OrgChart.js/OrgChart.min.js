!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("OrgChart",[],t):"object"==typeof exports?exports.OrgChart=t():e.OrgChart=t()}(this,function(){return i=[function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)})(a,[{key:"_closest",value:function(e,t){return e&&(t(e)&&e!==this.chart?e:this._closest(e.parentNode,t))}},{key:"_siblings",value:function(t,n){return Array.from(t.parentNode.children).filter(function(e){return e!==t&&(!n||t.matches(n))})}},{key:"_prevAll",value:function(e,t){for(var n=[],i=e.previousElementSibling;i;)t&&!i.matches(t)||n.push(i),i=i.previousElementSibling;return n}},{key:"_nextAll",value:function(e,t){for(var n=[],i=e.nextElementSibling;i;)t&&!i.matches(t)||n.push(i),i=i.nextElementSibling;return n}},{key:"_isVisible",value:function(e){return null!==e.offsetParent}},{key:"_addClass",value:function(e,n){e.forEach(function(t){0<n.indexOf(" ")?n.split(" ").forEach(function(e){return t.classList.add(e)}):t.classList.add(n)})}},{key:"_removeClass",value:function(e,n){e.forEach(function(t){0<n.indexOf(" ")?n.split(" ").forEach(function(e){return t.classList.remove(e)}):t.classList.remove(n)})}},{key:"_css",value:function(e,t,n){e.forEach(function(e){e.style[t]=n})}},{key:"_removeAttr",value:function(e,t){e.forEach(function(e){e.removeAttribute(t)})}},{key:"_one",value:function(n,i,s,r){n.addEventListener(i,function e(t){try{s.call(r,t)}finally{n.removeEventListener(i,e)}})}},{key:"_getDescElements",value:function(e,t){var n=[];return e.forEach(function(e){return n.push.apply(n,f(e.querySelectorAll(t)))}),n}},{key:"_getJSON",value:function(i){return new Promise(function(e,t){var n=new XMLHttpRequest;n.open("GET",i),n.onreadystatechange=function(){4===this.readyState&&(200===this.status?e(JSON.parse(this.response)):t(new Error(this.statusText)))},n.responseType="json",n.setRequestHeader("Content-Type","application/json"),n.send()})}},{key:"_buildJsonDS",value:function(e){var t=this,n={name:e.firstChild.textContent.trim(),relationship:("LI"===e.parentNode.parentNode.nodeName?"1":"0")+(1<e.parentNode.children.length?1:0)+(e.children.length?1:0)};return e.id&&(n.id=e.id),e.querySelector("ul")&&Array.from(e.querySelector("ul").children).forEach(function(e){n.children||(n.children=[]),n.children.push(t._buildJsonDS(e))}),n}},{key:"_attachRel",value:function(e,t){if(e.relationship=t+(e.children&&0<e.children.length?1:0),e.children){var n=!0,t=!1,i=void 0;try{for(var s,r=e.children[Symbol.iterator]();!(n=(s=r.next()).done);n=!0){var o=s.value;this._attachRel(o,"1"+(1<e.children.length?1:0))}}catch(e){t=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(t)throw i}}}return e}},{key:"_repaint",value:function(e){e&&(e.style.offsetWidth=e.offsetWidth)}},{key:"_isInAction",value:function(e){return-1<e.querySelector(":scope > .edge").className.indexOf("fa-")}},{key:"_getNodeState",value:function(e,t){var n=this,i=void 0,s={exist:!1,visible:!1};return"parent"===t?((i=this._closest(e,function(e){return e.classList&&e.classList.contains("nodes")}))&&(s.exist=!0),s.exist&&this._isVisible(i.parentNode.children[0])&&(s.visible=!0)):"children"===t?((i=this._closest(e,function(e){return"TR"===e.nodeName}).nextElementSibling)&&(s.exist=!0),s.exist&&this._isVisible(i)&&(s.visible=!0)):"siblings"===t&&((i=this._siblings(this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode)).length&&(s.exist=!0),s.exist&&i.some(function(e){return n._isVisible(e)})&&(s.visible=!0)),s}},{key:"getRelatedNodes",value:function(e,t){return"parent"===t?this._closest(e,function(e){return e.classList.contains("nodes")}).parentNode.children[0].querySelector(".node"):"children"===t?Array.from(this._closest(e,function(e){return"TABLE"===e.nodeName}).lastChild.children).map(function(e){return e.querySelector(".node")}):"siblings"===t?this._siblings(this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode).map(function(e){return e.querySelector(".node")}):void 0}},{key:"_switchHorizontalArrow",value:function(e){var t=this.options,n=e.querySelector(".leftEdge"),i=e.querySelector(".rightEdge"),s=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode;t.toggleSiblingsResp&&(void 0===t.ajaxURL||this._closest(e,function(e){return e.classList.contains(".nodes")}).dataset.siblingsLoaded)?(t=s.previousElementSibling,e=s.nextElementSibling,t&&(t.classList.contains("hidden")?(n.classList.add("fa-chevron-left"),n.classList.remove("fa-chevron-right")):(n.classList.add("fa-chevron-right"),n.classList.remove("fa-chevron-left"))),e&&(e.classList.contains("hidden")?(i.classList.add("fa-chevron-right"),i.classList.remove("fa-chevron-left")):(i.classList.add("fa-chevron-left"),i.classList.remove("fa-chevron-right")))):(e=!!(t=this._siblings(s)).length&&!t.some(function(e){return e.classList.contains("hidden")}),n.classList.toggle("fa-chevron-right",e),n.classList.toggle("fa-chevron-left",!e),i.classList.toggle("fa-chevron-left",e),i.classList.toggle("fa-chevron-right",!e))}},{key:"_hoverNode",value:function(e){var t=e.target,n=!1,i=t.querySelector(":scope > .topEdge"),s=t.querySelector(":scope > .bottomEdge"),r=t.querySelector(":scope > .leftEdge");"mouseenter"===e.type?(i&&(n=this._getNodeState(t,"parent").visible,i.classList.toggle("fa-chevron-up",!n),i.classList.toggle("fa-chevron-down",n)),s&&(n=this._getNodeState(t,"children").visible,s.classList.toggle("fa-chevron-down",!n),s.classList.toggle("fa-chevron-up",n)),r&&this._switchHorizontalArrow(t)):Array.from(t.querySelectorAll(":scope > .edge")).forEach(function(e){e.classList.remove("fa-chevron-up","fa-chevron-down","fa-chevron-right","fa-chevron-left")})}},{key:"_clickNode",value:function(e){var e=e.currentTarget,t=this.chart.querySelector(".focused");t&&t.classList.remove("focused"),e.classList.add("focused")}},{key:"_buildParentNode",value:function(e,t,o){var a=this,l=document.createElement("table");t.relationship="001",this._createNode(t,0).then(function(e){var t=a.chart,n=(e.classList.remove("slide-up"),e.classList.add("slide-down"),document.createElement("tr")),i=document.createElement("tr"),s=document.createElement("tr"),r=document.createElement("tr");n.setAttribute("class","hidden"),n.innerHTML='<td colspan="2"></td>',l.appendChild(n),i.setAttribute("class","lines hidden"),i.innerHTML='<td colspan="2"><div class="downLine"></div></td>',l.appendChild(i),s.setAttribute("class","lines hidden"),s.innerHTML='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>',l.appendChild(s),r.setAttribute("class","nodes"),r.innerHTML='<td colspan="2"></td>',l.appendChild(r),l.querySelector("td").appendChild(e),t.insertBefore(l,t.children[0]),l.children[3].children[0].appendChild(t.lastChild),o()}).catch(function(e){console.error("Failed to create parent node",e)})}},{key:"_switchVerticalArrow",value:function(e){e.classList.toggle("fa-chevron-up"),e.classList.toggle("fa-chevron-down")}},{key:"showParent",value:function(e){var t=this._prevAll(this._closest(e,function(e){return e.classList.contains("nodes")})),n=(this._removeClass(t,"hidden"),this._addClass(Array(t[0].children).slice(1,-1),"hidden"),t[2].querySelector(".node"));this._one(n,"transitionend",function(){n.classList.remove("slide"),this._isInAction(e)&&this._switchVerticalArrow(e.querySelector(":scope > .topEdge"))},this),this._repaint(n),n.classList.add("slide"),n.classList.remove("slide-down")}},{key:"showSiblings",value:function(e,t){var n=this,i=[],s=this._closest(e,function(e){return"TABLE"===e.nodeName}).parentNode,i=t?"left"===t?this._prevAll(s):this._nextAll(s):this._siblings(s),r=(this._removeClass(i,"hidden"),this._prevAll(this._closest(e,function(e){return e.classList.contains("nodes")}))),s=Array.from(r[0].querySelectorAll(":scope > .hidden"));t?this._removeClass(s.slice(0,2*i.length),"hidden"):this._removeClass(s,"hidden"),this._getNodeState(e,"parent").visible||(this._removeClass(r,"hidden"),t=r[2].querySelector(".node"),this._one(t,"transitionend",function(e){e.target.classList.remove("slide")},this),this._repaint(t),t.classList.add("slide"),t.classList.remove("slide-down")),i.forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){n._isVisible(e)&&(e.classList.add("slide"),e.classList.remove("slide-left","slide-right"))})}),this._one(i[0].querySelector(".slide"),"transitionend",function(){var t=this;i.forEach(function(e){t._removeClass(Array.from(e.querySelectorAll(".slide")),"slide")}),this._isInAction(e)&&(this._switchHorizontalArrow(e),e.querySelector(".topEdge").classList.remove("fa-chevron-up"),e.querySelector(".topEdge").classList.add("fa-chevron-down"))},this)}},{key:"hideSiblings",value:function(s,r){var t=this,o=this._closest(s,function(e){return"TABLE"===e.nodeName}).parentNode,a=(this._siblings(o).forEach(function(e){e.querySelector(".spinner")&&(t.chart.dataset.inAjax=!1)}),r&&"left"!==r||this._prevAll(o).forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){t._isVisible(e)&&e.classList.add("slide","slide-right")})}),r&&"left"===r||this._nextAll(o).forEach(function(e){Array.from(e.querySelectorAll(".node")).forEach(function(e){t._isVisible(e)&&e.classList.add("slide","slide-left")})}),[]),l=(this._siblings(o).forEach(function(e){Array.prototype.push.apply(a,Array.from(e.querySelectorAll(".slide")))}),[]),e=!0,n=!1,i=void 0;try{for(var d,c=a[Symbol.iterator]();!(e=(d=c.next()).done);e=!0){var h=d.value,u=this._closest(h,function(e){return e.classList.contains("nodes")}).previousElementSibling;l.push(u),l.push(u.previousElementSibling)}}catch(e){n=!0,i=e}finally{try{!e&&c.return&&c.return()}finally{if(n)throw i}}(l=[].concat(f(new Set(l)))).forEach(function(e){e.style.visibility="hidden"}),this._one(a[0],"transitionend",function(e){var t=this,n=(l.forEach(function(e){e.removeAttribute("style")}),[]),n=r?"left"===r?this._prevAll(o,":not(.hidden)"):this._nextAll(o,":not(.hidden)"):this._siblings(o),i=Array.from(this._closest(o,function(e){return e.classList.contains("nodes")}).previousElementSibling.querySelectorAll(":scope > :not(.hidden)")).slice(1,r?2*n.length+1:-1);this._addClass(i,"hidden"),this._removeClass(a,"slide"),n.forEach(function(e){Array.from(e.querySelectorAll(".node")).slice(1).forEach(function(e){t._isVisible(e)&&(e.classList.remove("slide-left","slide-right"),e.classList.add("slide-up"))})}),n.forEach(function(e){t._addClass(Array.from(e.querySelectorAll(".lines")),"hidden"),t._addClass(Array.from(e.querySelectorAll(".nodes")),"hidden"),t._addClass(Array.from(e.querySelectorAll(".verticalNodes")),"hidden")}),this._addClass(n,"hidden"),this._isInAction(s)&&this._switchHorizontalArrow(s)},this)}},{key:"hideAncestorsSiblings",value:function(e){var t=Array.from(this._closest(e,function(e){return e.classList.contains("nodes")}).parentNode.children).slice(0,3),n=(t[0].querySelector(".spinner")&&(this.chart.dataset.inAjax=!1),this._getNodeState(e,"siblings").visible&&this.hideSiblings(e),t.slice(1)),i=(this._css(n,"visibility","hidden"),t[0].querySelector(".node")),e=this._getNodeState(i,"parent").visible;i&&this._isVisible(i)&&(i.classList.add("slide","slide-down"),this._one(i,"transitionend",function(){i.classList.remove("slide"),this._removeAttr(n,"style"),this._addClass(t,"hidden")},this)),i&&e&&this.hideAncestorsSiblings(i)}},{key:"addParent",value:function(t,e){var n=this;this._buildParentNode(t,e,function(){var e;t.querySelector(":scope > .topEdge")||((e=document.createElement("i")).setAttribute("class","edge verticalEdge topEdge fa"),t.appendChild(e)),n.showParent(t)})}},{key:"_startLoading",value:function(e,t){var n=this.options,i=this.chart;if(void 0!==i.dataset.inAjax&&"true"===i.dataset.inAjax)return!1;e.classList.add("hidden");e=document.createElement("i"),e.setAttribute("class","fa fa-circle-o-notch fa-spin spinner"),t.appendChild(e),this._addClass(Array.from(t.querySelectorAll(":scope > *:not(.spinner)")),"hazy"),i.dataset.inAjax=!0,e=this.chartContainer.querySelector(".oc-export-btn"+(""!==n.chartClass?"."+n.chartClass:""));return e&&(e.disabled=!0),!0}},{key:"_endLoading",value:function(e,t){var n=this.options,e=(e.classList.remove("hidden"),t.querySelector(":scope > .spinner").remove(),this._removeClass(Array.from(t.querySelectorAll(":scope > .hazy")),"hazy"),this.chart.dataset.inAjax=!1,this.chartContainer.querySelector(".oc-export-btn"+(""!==n.chartClass?"."+n.chartClass:"")));e&&(e.disabled=!1)}},{key:"_clickTopEdge",value:function(e){e.stopPropagation();var t,n=this,i=e.target,s=i.parentNode,e=this._getNodeState(s,"parent"),r=this.options;e.exist?(t=this._closest(s,function(e){return e.classList.contains("nodes")}).parentNode.firstChild.querySelector(".node")).classList.contains("slide")||(e.visible?(this.hideAncestorsSiblings(s),this._one(t,"transitionend",function(){this._isInAction(s)&&(this._switchVerticalArrow(i),this._switchHorizontalArrow(s))},this)):this.showParent(s)):(e=i.parentNode.id,this._startLoading(i,s)&&this._getJSON("function"==typeof r.ajaxURL.parent?r.ajaxURL.parent(s.dataset.source):r.ajaxURL.parent+e).then(function(e){"true"===n.chart.dataset.inAjax&&Object.keys(e).length&&n.addParent(s,e)}).catch(function(e){console.error("Failed to get parent node data.",e)}).finally(function(){n._endLoading(i,s)}))}},{key:"hideDescendants",value:function(t){var n=this,i=this._nextAll(t.parentNode.parentNode),s=[],r=(i[2].querySelector(".spinner")&&(this.chart.dataset.inAjax=!1),Array.from(i[2].querySelectorAll(".node")).filter(function(e){return n._isVisible(e)})),o=i[2].classList.contains("verticalNodes");o||(r.forEach(function(e){Array.prototype.push.apply(s,n._prevAll(n._closest(e,function(e){return e.classList.contains("nodes")}),".lines"))}),s=[].concat(f(new Set(s))),this._css(s,"visibility","hidden")),this._one(r[0],"transitionend",function(e){this._removeClass(r,"slide"),o?n._addClass(i,"hidden"):(s.forEach(function(e){e.removeAttribute("style"),e.classList.add("hidden"),e.parentNode.lastChild.classList.add("hidden")}),this._addClass(Array.from(i[2].querySelectorAll(".verticalNodes")),"hidden")),this._isInAction(t)&&this._switchVerticalArrow(t.querySelector(".bottomEdge"))},this),this._addClass(r,"slide slide-up")}},{key:"showDescendants",value:function(t){var n=this,i=this,e=this._nextAll(t.parentNode.parentNode),s=[];this._removeClass(e,"hidden"),e.some(function(e){return e.classList.contains("verticalNodes")})?e.forEach(function(e){Array.prototype.push.apply(s,Array.from(e.querySelectorAll(".node")).filter(function(e){return i._isVisible(e)}))}):Array.from(e[2].children).forEach(function(e){Array.prototype.push.apply(s,Array.from(e.querySelector("tr").querySelectorAll(".node")).filter(function(e){return i._isVisible(e)}))}),this._repaint(s[0]),this._one(s[0],"transitionend",function(e){n._removeClass(s,"slide"),n._isInAction(t)&&n._switchVerticalArrow(t.querySelector(".bottomEdge"))},this),this._addClass(s,"slide"),this._removeClass(s,"slide-up")}},{key:"_buildChildNode",value:function(e,t,n){t=t.children||t.siblings;e.querySelector("td").setAttribute("colSpan",2*t.length),this.buildHierarchy(e,{children:t},0,n)}},{key:"addChildren",value:function(t,n){var i=this,s=this.options,r=0;this.chart.dataset.inEdit="addChildren",this._buildChildNode.call(this,this._closest(t,function(e){return"TABLE"===e.nodeName}),n,function(){var e;++r===n.children.length&&(t.querySelector(".bottomEdge")||((e=document.createElement("i")).setAttribute("class","edge verticalEdge bottomEdge fa"),t.appendChild(e)),t.querySelector(".symbol")||((e=document.createElement("i")).setAttribute("class","fa "+s.parentNodeSymbol+" symbol"),t.querySelector(":scope > .title").appendChild(e)),i.showDescendants(t),i.chart.dataset.inEdit="")})}},{key:"_clickBottomEdge",value:function(e){var t,n=this,i=(e.stopPropagation(),this),s=this.options,r=e.target,o=r.parentNode,e=this._getNodeState(o,"children");e.exist?(t=this._closest(o,function(e){return"TR"===e.nodeName}).parentNode.children[3],Array.from(t.querySelectorAll(".node")).some(function(e){return n._isVisible(e)&&e.classList.contains("slide")})||(e.visible?this.hideDescendants(o):this.showDescendants(o))):(t=r.parentNode.id,this._startLoading(r,o)&&this._getJSON("function"==typeof s.ajaxURL.children?s.ajaxURL.children(o.dataset.source):s.ajaxURL.children+t).then(function(e){"true"===i.chart.dataset.inAjax&&e.children.length&&i.addChildren(o,e)}).catch(function(e){console.error("Failed to get children nodes data",e)}).finally(function(){i._endLoading(r,o)}))}},{key:"_complementLine",value:function(e,t,n){var i=e.parentNode.parentNode.children;i[0].children[0].setAttribute("colspan",2*t),i[1].children[0].setAttribute("colspan",2*t);for(var s=0;s<n;s++){var r=document.createElement("td"),o=document.createElement("td");r.setAttribute("class","rightLine topLine"),r.innerHTML="&nbsp;",i[2].insertBefore(r,i[2].children[1]),o.setAttribute("class","leftLine topLine"),o.innerHTML="&nbsp;",i[2].insertBefore(o,i[2].children[1])}}},{key:"_buildSiblingNode",value:function(n,e,i){var s,t,r,o=this,a=this,l=(e.siblings||e.children).length,d="TD"===n.parentNode.nodeName?this._closest(n,function(e){return"TR"===e.nodeName}).children.length:1,c=d+l,h=1<c?Math.floor(c/2-1):0;"TD"===n.parentNode.nodeName?((t=o._prevAll(n.parentNode.parentNode))[0].remove(),t[1].remove(),r=0,a._buildChildNode.call(a,a._closest(n.parentNode,function(e){return"TABLE"===e.nodeName}),e,function(){var e,t;++r===l&&(t=Array.from(a._closest(n.parentNode,function(e){return"TABLE"===e.nodeName}).lastChild.children),1<d?(Array.from(n.parentNode.children).forEach(function(e){t[0].parentNode.insertBefore(e,t[0])}),n.parentNode.parentNode.remove(),a._complementLine(t[0],c,d),a._addClass(t,"hidden"),t.forEach(function(e){a._addClass(e.querySelectorAll(".node"),"slide-left")})):(e=n.parentNode.parentNode,t[h].parentNode.insertBefore(n.parentNode,t[h+1]),e.remove(),a._complementLine(t[h],c,1),a._addClass(t,"hidden"),a._addClass(a._getDescElements(t.slice(0,h+1),".node"),"slide-right"),a._addClass(a._getDescElements(t.slice(h+1),".node"),"slide-left")),i())})):(s=0,a.buildHierarchy.call(a,a.chart,e,0,function(){var e,t;++s===c&&(t=n.nextElementSibling.children[3].children[h],(e=document.createElement("td")).setAttribute("colspan",2),e.appendChild(n),t.parentNode.insertBefore(e,t.nextElementSibling),a._complementLine(t,c,1),(e=a._closest(n,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0]).classList.add("hidden"),a._addClass(Array.from(e.querySelectorAll(".node")),"slide-down"),t=o._siblings(n.parentNode),a._addClass(t,"hidden"),a._addClass(a._getDescElements(t.slice(0,h),".node"),"slide-right"),a._addClass(a._getDescElements(t.slice(h),".node"),"slide-left"),i())}))}},{key:"addSiblings",value:function(n,e){var i=this;this.chart.dataset.inEdit="addSiblings",this._buildSiblingNode.call(this,this._closest(n,function(e){return"TABLE"===e.nodeName}),e,function(){var e,t;i._closest(n,function(e){return e.classList&&e.classList.contains("nodes")}).dataset.siblingsLoaded=!0,n.querySelector(".leftEdge")||(e=document.createElement("i"),t=document.createElement("i"),e.setAttribute("class","edge horizontalEdge rightEdge fa"),n.appendChild(e),t.setAttribute("class","edge horizontalEdge leftEdge fa"),n.appendChild(t)),i.showSiblings(n),i.chart.dataset.inEdit=""})}},{key:"_clickHorizontalEdge",value:function(e){var t,n,i=this,s=(e.stopPropagation(),this),r=this.options,o=e.target,a=o.parentNode,e=this._getNodeState(a,"siblings");e.exist?(t=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode,this._siblings(t).some(function(e){e=e.querySelector(".node");return i._isVisible(e)&&e.classList.contains("slide")})||(r.toggleSiblingsResp?(t=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode.previousElementSibling,n=this._closest(a,function(e){return"TABLE"===e.nodeName}).parentNode.nextElementSibling,o.classList.contains("leftEdge")?t.classList.contains("hidden")?this.showSiblings(a,"left"):this.hideSiblings(a,"left"):n.classList.contains("hidden")?this.showSiblings(a,"right"):this.hideSiblings(a,"right")):e.visible?this.hideSiblings(a):this.showSiblings(a))):(t=o.parentNode.id,n=this._getNodeState(a,"parent").exist?"function"==typeof r.ajaxURL.siblings?r.ajaxURL.siblings(JSON.parse(a.dataset.source)):r.ajaxURL.siblings+t:"function"==typeof r.ajaxURL.families?r.ajaxURL.families(JSON.parse(a.dataset.source)):r.ajaxURL.families+t,this._startLoading(o,a)&&this._getJSON(n).then(function(e){"true"===s.chart.dataset.inAjax&&(e.siblings||e.children)&&s.addSiblings(a,e)}).catch(function(e){console.error("Failed to get sibling nodes data",e)}).finally(function(){s._endLoading(o,a)}))}},{key:"_clickToggleButton",value:function(e){var t=this,e=e.target,n=e.parentNode.nextElementSibling,i=n.querySelectorAll(".node"),s=n.children.map(function(e){return e.querySelector(".node")});s.some(function(e){return e.classList.contains(".slide")})||(e.classList.toggle("fa-plus-square"),e.classList.toggle("fa-minus-square"),i[0].classList.contains(".slide-up")?(n.classList.remove("hidden"),this._repaint(s[0]),this._addClass(s,"slide"),this._removeClass(s,"slide-up"),s[0].addEventListener("transitionend",function(){t._removeClass(s,"slide")},{once:!0})):(this._addClass(i,"slide slide-up"),i[0].addEventListener("transitionend",function(){t._removeClass(i,"slide"),this._closest(i[0],function(e){return"ul"===e.nodeName}).classList.add("hidden")},{once:!0}),i[0].querySelector(".toggleBtn").classList.remove("fa-minus-square").classList.add("fa-plus-square")))}},{key:"_dispatchClickEvent",value:function(e){var t=e.target.classList;t.contains("topEdge")?this._clickTopEdge(e):t.contains("rightEdge")||t.contains("leftEdge")?this._clickHorizontalEdge(e):t.contains("bottomEdge")?this._clickBottomEdge(e):t.contains("toggleBtn")?this._clickToggleButton(e):this._clickNode(e)}},{key:"_onDragStart",value:function(e){var t,n,i,s,r,o=e.target,a=this.options,l=/firefox/.test(window.navigator.userAgent.toLowerCase()),d=(l&&e.dataTransfer.setData("text/html","hack for firefox"),this.chart.style.transform&&(n=t=void 0,document.querySelector(".ghost-node")?n=(t=this.chart.querySelector(":scope > .ghost-node")).children[0]:((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).classList.add("ghost-node"),n=document.createElementNS("http://www.w3.org/2000/svg","rect"),t.appendChild(n),this.chart.appendChild(t)),i=this.chart.style.transform.split(","),i=Math.abs(window.parseFloat("t2b"===a.direction||"b2t"===a.direction?i[0].slice(i[0].indexOf("(")+1):i[1])),t.setAttribute("width",o.offsetWidth),t.setAttribute("height",o.offsetHeight),n.setAttribute("x",5*i),n.setAttribute("y",5*i),n.setAttribute("width",120*i),n.setAttribute("height",40*i),n.setAttribute("rx",4*i),n.setAttribute("ry",4*i),n.setAttribute("stroke-width",+i),s=e.offsetX*i,r=e.offsetY*i,"l2r"===a.direction?(s=e.offsetY*i,r=e.offsetX*i):"r2l"===a.direction?(s=o.offsetWidth-e.offsetY*i,r=e.offsetX*i):"b2t"===a.direction&&(s=o.offsetWidth-e.offsetX*i,r=o.offsetHeight-e.offsetY*i),l?((o=document.createElement("img")).src="data:image/svg+xml;utf8,"+(new XMLSerializer).serializeToString(t),e.dataTransfer.setDragImage(o,s,r),n.setAttribute("fill","rgb(255, 255, 255)"),n.setAttribute("stroke","rgb(191, 0, 0)")):e.dataTransfer.setDragImage(t,s,r)),e.target),c=this._closest(d,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0].querySelector(".node"),h=Array.from(this._closest(d,function(e){return"TABLE"===e.nodeName}).querySelectorAll(".node"));this.dragged=d,Array.from(this.chart.querySelectorAll(".node")).forEach(function(e){h.includes(e)||a.dropCriteria&&!a.dropCriteria(d,c,e)||e.classList.add("allowedDrop")})}},{key:"_onDragOver",value:function(e){e.preventDefault(),e.currentTarget.classList.contains("allowedDrop")||(e.dataTransfer.dropEffect="none")}},{key:"_onDragEnd",value:function(e){Array.from(this.chart.querySelectorAll(".allowedDrop")).forEach(function(e){e.classList.remove("allowedDrop")})}},{key:"_onDrop",value:function(e){var t,n,e=e.currentTarget,i=this.chart,s=this.dragged,r=this._closest(s,function(e){return e.classList&&e.classList.contains("nodes")}).parentNode.children[0].children[0],o=(this._removeClass(Array.from(i.querySelectorAll(".allowedDrop")),"allowedDrop"),e.parentNode.parentNode.nextElementSibling?(a=window.parseInt(e.parentNode.colSpan)+2,e.parentNode.setAttribute("colspan",a),e.parentNode.parentNode.nextElementSibling.children[0].setAttribute("colspan",a),s.querySelector(".horizontalEdge")||(a=document.createElement("i"),t=document.createElement("i"),a.setAttribute("class","edge horizontalEdge rightEdge fa"),s.appendChild(a),t.setAttribute("class","edge horizontalEdge leftEdge fa"),s.appendChild(t)),a=e.parentNode.parentNode.nextElementSibling.nextElementSibling,t=document.createElement("td"),o=document.createElement("td"),t.setAttribute("class","leftLine topLine"),t.innerHTML="&nbsp;",a.insertBefore(t,a.children[1]),o.setAttribute("class","rightLine topLine"),o.innerHTML="&nbsp;",a.insertBefore(o,a.children[2]),a.nextElementSibling.appendChild(this._closest(s,function(e){return"TABLE"===e.nodeName}).parentNode),1===(t=this._siblings(this._closest(s,function(e){return"TABLE"===e.nodeName}).parentNode).map(function(e){return e.querySelector(".node")})).length&&(o=document.createElement("i"),a=document.createElement("i"),o.setAttribute("class","edge horizontalEdge rightEdge fa"),t[0].appendChild(o),a.setAttribute("class","edge horizontalEdge leftEdge fa"),t[0].appendChild(a))):((o=document.createElement("i")).setAttribute("class","edge verticalEdge bottomEdge fa"),e.appendChild(o),e.parentNode.setAttribute("colspan",2),t=this._closest(e,function(e){return"TABLE"===e.nodeName}),a=document.createElement("tr"),o=document.createElement("tr"),n=document.createElement("tr"),a.setAttribute("class","lines"),a.innerHTML='<td colspan="2"><div class="downLine"></div></td>',t.appendChild(a),o.setAttribute("class","lines"),o.innerHTML='<td class="rightLine">&nbsp;</td><td class="leftLine">&nbsp;</td>',t.appendChild(o),n.setAttribute("class","nodes"),t.appendChild(n),Array.from(s.querySelectorAll(".horizontalEdge")).forEach(function(e){s.removeChild(e)}),a=this._closest(s,function(e){return"TABLE"===e.nodeName}).parentNode,n.appendChild(a)),window.parseInt(r.colSpan)),a=(2<o?(r.setAttribute("colspan",o-2),r.parentNode.nextElementSibling.children[0].setAttribute("colspan",o-2),(t=r.parentNode.nextElementSibling.nextElementSibling).children[1].remove(),t.children[1].remove(),1===(n=Array.from(r.parentNode.parentNode.children[3].children).map(function(e){return e.querySelector(".node")})).length&&(n[0].querySelector(".leftEdge").remove(),n[0].querySelector(".rightEdge").remove())):(r.removeAttribute("colspan"),r.querySelector(".node").removeChild(r.querySelector(".bottomEdge")),Array.from(r.parentNode.parentNode.children).slice(1).forEach(function(e){return e.remove()})),new CustomEvent("nodedropped.orgchart",{detail:{draggedNode:s,dragZone:r.children[0],dropZone:e}}));i.dispatchEvent(a)}},{key:"_createNode",value:function(d,c){var h=this,u=this.options;return new Promise(function(e,t){if(d.children){var n=!0,i=!1,s=void 0;try{for(var r,o=d.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)r.value.parentId=d.id}catch(e){i=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw s}}}var a,i=document.createElement("div"),s=(delete d.children,i.dataset.source=JSON.stringify(d),d[u.nodeId]&&(i.id=d[u.nodeId]),h.chart.dataset.inEdit),l=void 0,l=s?"addChildren"===s?" slide-up":"":c>=u.depth?" slide-up":"",s=(i.setAttribute("class","node "+(d.className||"")+l),u.draggable&&i.setAttribute("draggable",!0),d.parentId&&i.setAttribute("data-parent",d.parentId),i.innerHTML='\n        <div class="title">'+d[u.nodeTitle]+"</div>\n        "+(u.nodeContent?'<div class="content">'+d[u.nodeContent]+"</div>":"")+"\n      ",d.relationship||"");u.verticalDepth&&c+2>u.verticalDepth?c+1>=u.verticalDepth&&Number(s.substr(2,1))&&((l=document.createElement("i")).setAttribute("class","toggleBtn fa fa-minus-square"),i.appendChild(l)):(Number(s.substr(0,1))&&((l=document.createElement("i")).setAttribute("class","edge verticalEdge topEdge fa"),i.appendChild(l)),Number(s.substr(1,1))&&(l=document.createElement("i"),a=document.createElement("i"),l.setAttribute("class","edge horizontalEdge rightEdge fa"),i.appendChild(l),a.setAttribute("class","edge horizontalEdge leftEdge fa"),i.appendChild(a)),Number(s.substr(2,1))&&(l=document.createElement("i"),a=document.createElement("i"),s=i.querySelector(":scope > .title"),l.setAttribute("class","edge verticalEdge bottomEdge fa"),i.appendChild(l),a.setAttribute("class","fa "+u.parentNodeSymbol+" symbol"),s.insertBefore(a,s.children[0]))),i.addEventListener("mouseenter",h._hoverNode.bind(h)),i.addEventListener("mouseleave",h._hoverNode.bind(h)),i.addEventListener("click",h._dispatchClickEvent.bind(h)),u.draggable&&(i.addEventListener("dragstart",h._onDragStart.bind(h)),i.addEventListener("dragover",h._onDragOver.bind(h)),i.addEventListener("dragend",h._onDragEnd.bind(h)),i.addEventListener("drop",h._onDrop.bind(h))),u.createNode&&u.createNode(i,d),e(i)})}},{key:"buildHierarchy",value:function(e,t,n,i){var s,r,o=this,a=this.options,l=void 0,d=t.children,c=a.verticalDepth&&n+1>=a.verticalDepth;1<Object.keys(t).length&&(l=c?e:document.createElement("table"),c||e.appendChild(l),this._createNode(t,n).then(function(e){var t;c?l.appendChild(e):((t=document.createElement("tr")).innerHTML="\n            <td "+(d?'colspan="'+2*d.length+'"':"")+">\n            </td>\n          ",t.children[0].appendChild(e),l.insertBefore(t,l.children[0]||null)),i&&i()}).catch(function(e){console.error("Failed to creat node",e)})),d&&(t=void(1===Object.keys(t).length&&(l=e)),s=a.verticalDepth&&n+2>=a.verticalDepth,e=o.chart.dataset.inEdit,t=e?"addSiblings"===e?"":" hidden":n+1>=a.depth?" hidden":"",s||((e=document.createElement("tr")).setAttribute("class","lines"+t),e.innerHTML='\n          <td colspan="'+2*d.length+'">\n            <div class="downLine"></div>\n          </td>\n        ',l.appendChild(e)),(e=document.createElement("tr")).setAttribute("class","lines"+t),r=void(e.innerHTML='\n        <td class="rightLine">&nbsp;</td>\n        '+d.slice(1).map(function(){return'\n          <td class="leftLine topLine">&nbsp;</td>\n          <td class="rightLine topLine">&nbsp;</td>\n          '}).join("")+'\n        <td class="leftLine">&nbsp;</td>\n      '),s?(r=document.createElement("<ul>"),n+2===a.verticalDepth?((a=document.createElement("tr")).setAttribute("class","verticalNodes"),a.innerHTML="<td></td>",a.firstChild.appendChild(r)):l.appendChild(r)):((r=document.createElement("tr")).setAttribute("class","nodes"+t),l.appendChild(e),l.appendChild(r)),d.forEach(function(e){var t=void 0;s?t=document.createElement("li"):(t=document.createElement("td")).setAttribute("colspan",2),r.appendChild(t),o.buildHierarchy(t,e,n+1,i)}))}},{key:"_clickChart",value:function(e){!this._closest(e.target,function(e){return e.classList&&e.classList.contains("node")})&&this.chart.querySelector(".node.focused")&&this.chart.querySelector(".node.focused").classList.remove("focused")}},{key:"_clickExportButton",value:function(){var e=this.options,n=this.chartContainer,t=n.querySelector(":scope > .mask"),i=n.querySelector(".orgchart:not(.hidden)"),e="l2r"===e.direction||"r2l"===e.direction;t?t.classList.remove("hidden"):((t=document.createElement("div")).setAttribute("class","mask"),t.innerHTML='<i class="fa fa-circle-o-notch fa-spin spinner"></i>',n.appendChild(t)),n.classList.add("canvasContainer"),window.html2canvas(i,{width:e?i.clientHeight:i.clientWidth,height:e?i.clientWidth:i.clientHeight,onclone:function(e){e=e.querySelector(".canvasContainer");e.style.overflow="visible",e.querySelector(".orgchart:not(.hidden)").transform=""}}).then(function(e){var t=n.querySelector(".oc-download-btn");n.querySelector(".mask").classList.add("hidden"),t.setAttribute("href",e.toDataURL()),t.click()}).catch(function(e){console.error("Failed to export the curent orgchart!",e)}).finally(function(){n.classList.remove("canvasContainer")})}},{key:"_loopChart",value:function(e){var t=this,n={id:e.querySelector(".node").id};return e.children[3]&&Array.from(e.children[3].children).forEach(function(e){n.children||(n.children=[]),n.children.push(t._loopChart(e.firstChild))}),n}},{key:"getHierarchy",value:function(){return this.chart.querySelector(".node").id?this._loopChart(this.chart.querySelector("table")):"Error: Nodes of orghcart to be exported must have id attribute!"}},{key:"_onPanStart",value:function(e){var t=e.currentTarget;if(this._closest(e.target,function(e){return e.classList&&e.classList.contains("node")})||e.touches&&1<e.touches.length)t.dataset.panning=!1;else{t.style.cursor="move",t.dataset.panning=!0;var n=0,i=0,s=window.getComputedStyle(t).transform,s=("none"!==s&&(r=s.split(","),i=s.includes("3d")?(n=Number.parseInt(r[12],10),Number.parseInt(r[13],10)):(n=Number.parseInt(r[4],10),Number.parseInt(r[5],10))),0),r=0;if(e.targetTouches){if(1===e.targetTouches.length)s=e.targetTouches[0].pageX-n,r=e.targetTouches[0].pageY-i;else if(1<e.targetTouches.length)return}else s=e.pageX-n,r=e.pageY-i;t.dataset.panStart=JSON.stringify({startX:s,startY:r}),t.addEventListener("mousemove",this._onPanning.bind(this)),t.addEventListener("touchmove",this._onPanning.bind(this))}}},{key:"_onPanning",value:function(e){var t=e.currentTarget;if("false"!==t.dataset.panning){var n=0,i=0,s=JSON.parse(t.dataset.panStart),r=s.startX,s=s.startY;if(e.targetTouches){if(1===e.targetTouches.length)n=e.targetTouches[0].pageX-r,i=e.targetTouches[0].pageY-s;else if(1<e.targetTouches.length)return}else n=e.pageX-r,i=e.pageY-s;r=window.getComputedStyle(t).transform;"none"===r?r.includes("3d")?t.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, "+n+", "+i+", 0, 1)":t.style.transform="matrix(1, 0, 0, 1, "+n+", "+i+")":(e=r.split(","),r.includes("3d")?(e[12]=n,e[13]=i):(e[4]=n,e[5]=i+")"),t.style.transform=e.join(","))}}},{key:"_onPanEnd",value:function(e){var t=this.chart;"true"===t.dataset.panning&&(t.dataset.panning=!1,t.style.cursor="default",document.body.removeEventListener("mousemove",this._onPanning),document.body.removeEventListener("touchmove",this._onPanning))}},{key:"_setChartScale",value:function(e,t){var n,i=window.getComputedStyle(e).transform;"none"===i?e.style.transform="scale("+t+","+t+")":(n=i.split(","),i.includes("3d")?e.style.transform=i+" scale3d("+t+","+t+", 1)":(n[0]="matrix("+t,n[3]=t,e.style.transform=i+" scale("+t+","+t+")")),e.dataset.scale=t}},{key:"_onWheeling",value:function(e){e.preventDefault();e=0<e.deltaY?.8:1.2;this._setChartScale(this.chart,e)}},{key:"_getPinchDist",value:function(e){return Math.sqrt((e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[0].clientY-e.touches[1].clientY)*(e.touches[0].clientY-e.touches[1].clientY))}},{key:"_onTouchStart",value:function(e){var t=this.chart;e.touches&&2===e.touches.length&&(e=this._getPinchDist(e),t.dataset.pinching=!0,t.dataset.pinchDistStart=e)}},{key:"_onTouchMove",value:function(e){var t=this.chart;t.dataset.pinching&&(e=this._getPinchDist(e),t.dataset.pinchDistEnd=e)}},{key:"_onTouchEnd",value:function(e){var t,n=this.chart;n.dataset.pinching&&(n.dataset.pinching=!1,0<(t=n.dataset.pinchDistEnd-n.dataset.pinchDistStart)?this._setChartScale(n,1):t<0&&this._setChartScale(n,-1))}},{key:"name",get:function(){return this._name}}]);var n=a;function a(e){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._name="OrgChart",Promise.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})})};var t,n=this,i=Object.assign({nodeTitle:"name",nodeId:"id",toggleSiblingsResp:!1,depth:999,chartClass:"",exportButton:!1,exportFilename:"OrgChart",parentNodeSymbol:"fa-users",draggable:!1,direction:"t2b",pan:!1,zoom:!1},e),e=i.data,s=document.createElement("div"),r=document.querySelector(i.chartContainer);this.options=i,delete this.options.data,this.chart=s,this.chartContainer=r,s.dataset.options=JSON.stringify(i),s.setAttribute("class","orgchart"+(""!==i.chartClass?" "+i.chartClass:"")+("t2b"!==i.direction?" "+i.direction:"")),"object"===(void 0===e?"undefined":o(e))?this.buildHierarchy(s,i.ajaxURL?e:this._attachRel(e,"00"),0):"string"==typeof e&&e.startsWith("#")?this.buildHierarchy(s,this._buildJsonDS(document.querySelector(e).children[0]),0):((t=document.createElement("i")).setAttribute("class","fa fa-circle-o-notch fa-spin spinner"),s.appendChild(t),this._getJSON(e).then(function(e){n.buildHierarchy(s,i.ajaxURL?e:n._attachRel(e,"00"),0)}).catch(function(e){console.error("failed to fetch datasource for orgchart",e)}).finally(function(){var e=s.querySelector(".spinner");e.parentNode.removeChild(e)})),s.addEventListener("click",this._clickChart.bind(this)),i.exportButton&&!r.querySelector(".oc-export-btn")&&(t=document.createElement("button"),e=document.createElement("a"),t.setAttribute("class","oc-export-btn"+(""!==i.chartClass?" "+i.chartClass:"")),t.innerHTML="Export",t.addEventListener("click",this._clickExportButton.bind(this)),e.setAttribute("class","oc-download-btn"+(""!==i.chartClass?" "+i.chartClass:"")),e.setAttribute("download",i.exportFilename+".png"),r.appendChild(t),r.appendChild(e)),i.pan&&(r.style.overflow="hidden",s.addEventListener("mousedown",this._onPanStart.bind(this)),s.addEventListener("touchstart",this._onPanStart.bind(this)),document.body.addEventListener("mouseup",this._onPanEnd.bind(this)),document.body.addEventListener("touchend",this._onPanEnd.bind(this))),i.zoom&&(r.addEventListener("wheel",this._onWheeling.bind(this)),r.addEventListener("touchstart",this._onTouchStart.bind(this)),document.body.addEventListener("touchmove",this._onTouchMove.bind(this)),document.body.addEventListener("touchend",this._onTouchEnd.bind(this))),r.appendChild(s)}t.default=n,e.exports=t.default}],s={},n.m=i,n.c=s,n.p="",n(0);function n(e){if(s[e])return s[e].exports;var t=s[e]={exports:{},id:e,loaded:!1};return i[e].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var i,s});